---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import Button from '@/components/ui/Button.astro'
import { formatDate } from '@/lib/utils'
interface Props {
	imagePath?: string
	altText?: string
	title?: string
	link?: string
	id?: number
	author?: {
		node: {
			name: string
		}
	}
	post?: {
		title: string
		date: string
		slug: string
		featuredImage?: { node: { sourceUrl: string; altText: string } }
	} | null
}
const lang = Astro.params.lang || 'en'
const { link, imagePath, altText, title, post = null } = Astro.props
if (imagePath) {
	const images = import.meta.glob<{ default: ImageMetadata }>('/src/images/*.{jpeg,jpg,png,gif}')
	if (!images[imagePath])
		throw new Error(`"${imagePath}" does not exist in glob: "src/images/*.{jpeg,jpg,png,gif}"`)
}
---

{
	post !== null ? (
		<a
			class="group relative block rounded-xl focus:outline-none"
			href={`/${lang}/blog/${post.slug}/`}
		>
			<div class="relative h-[250px] w-full shrink-0 overflow-hidden rounded-xl before:absolute before:inset-x-0 before:z-[1] before:size-full before:bg-black/70">
				<Image
					src={post?.featuredImage?.node?.sourceUrl}
					alt={post?.featuredImage?.node?.altText}
					width={768}
					height={480}
					class="h-full object-cover"
				/>
			</div>

			<div class="absolute inset-x-0 top-0 z-10">
				<div class="flex h-full flex-col p-4 sm:p-6">
					<div class="flex items-center">
						<div class="shrink-0">
							<img
								class="size-[46px] rounded-full border-2 border-white"
								src="https://images.unsplash.com/photo-1669837401587-f9a4cfe3126e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80"
								alt="Avatar"
							/>
						</div>
						<div class="ms-2.5 sm:ms-4">
							<h4 class="font-semibold text-white">{post.author.node.name}</h4>
							<p class="flex items-center gap-2 text-xs text-white/80">
								<iconify-icon
									icon="formkit:datetime"
									width="15"
									height="15"
									class="text-white"
								/>
								{formatDate(post.date)}
							</p>
						</div>
					</div>
				</div>
			</div>

			<div class="absolute inset-x-0 bottom-0 z-10">
				<div class="flex h-full flex-col p-4 sm:p-6">
					<h3 class="text-xl font-semibold text-white group-hover:text-white/80 group-focus:text-white/80 sm:text-xl">
						{post.title}
					</h3>
				</div>
			</div>
		</a>
	) : (
		<div class="relative h-[300px] overflow-hidden rounded-xl shadow-sm">
			<Image
				src={images[imagePath]()}
				class="h-full w-full rounded-xl object-cover"
				alt={title}
				loading="eager"
			/>
			<div class="absolute inset-0 end-0 start-0 top-0 overflow-hidden bg-black/45">
				<div class="flex h-full flex-col justify-between p-4 md:p-5">
					<h3 class="text-3xl font-bold text-white">{title}</h3>
					<div>
						<Button
							text="View More"
							primary={false}
							rippleEffect="true"
							primary="true"
							href={link}
						/>
					</div>
				</div>
			</div>
		</div>
	)
}
